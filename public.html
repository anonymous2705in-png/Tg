<!DOCTYPE html>
<html lang="ta">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>File To Link</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

body {
  background: linear-gradient(135deg,#0b1a2a,#14202b);
  color: #e6edf3;
  font-family: 'Inter', system-ui, Segoe UI, Roboto, sans-serif;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 18px;
}

.card {
  width: 100%;
  max-width: 720px;
  border-radius: 15px;
  padding: 25px 30px;
  background: rgba(15,20,30,0.97);
  box-shadow: 0 12px 45px rgba(0,0,0,0.6);
  position: relative;
}

.header-section {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 15px;
}

.title-section {
  flex: 1;
}

h4 {
  font-weight: 600;
  color: #38bdf8;
  margin-bottom: 5px;
}

.subtitle {
  color: #f1f5f9;
  margin-bottom: 0;
}

.how-to-btn {
  background: #38bdf8;
  border: none;
  border-radius: 8px;
  padding: 8px 16px;
  color: white;
  font-size: 0.85rem;
  text-decoration: none;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: all 0.3s ease;
  white-space: nowrap;
  margin-left: 15px;
  margin-top: 5px;
}

.how-to-btn:hover {
  background: #0ea5e9;
  color: white;
  text-decoration: none;
  transform: translateY(-2px);
}

.log {
  background: #1a2230;
  border-radius: 12px;
  padding: 14px;
  color: #cbd5e1;
  min-height: 120px;
  max-height: 220px;
  overflow: auto;
  white-space: pre-wrap;
  font-size: 0.95rem;
}

.file-item {
  background: #1e2a3a;
  border-radius: 12px;
  padding: 14px;
  margin-top: 16px;
  transition: all 0.2s ease;
}

.file-item:hover {
  background: #25334c;
}

a.short {
  color: #38bdf8;
  word-break: break-all;
  text-decoration: underline;
}

.muted {
  color: #a0aec0;
  font-size: 0.9rem;
}

.info-box {
  background: #1e2a3a;
  border-left: 4px solid #38bdf8;
  border-radius: 10px;
  padding: 14px 16px;
  margin-top: 20px;
  font-size: 0.95rem;
  color: #f1f5f9;
}

.developer {
  text-align: right;
  font-size: 0.85rem;
  color: #a0aec0;
  margin-top: 10px;
}

.developer a {
  color: #38bdf8;
  text-decoration: none;
  font-weight: 500;
}

.developer a:hover {
  text-decoration: underline;
}

input.form-control-sm {
  background: #1a2230;
  color: #e6edf3;
  border: 1px solid #334155;
}

input.form-control-sm::placeholder {
  color: #94a3b8;
}

input.form-control-sm:focus {
  border-color: #38bdf8;
  box-shadow: 0 0 0 0.2rem rgba(56, 221, 248, 0.25);
  background: #1a2230;
  color: #e6edf3;
}

button {
  font-weight: 500;
}

/* Responsive design */
@media (max-width: 576px) {
  .header-section {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .how-to-btn {
    margin-left: 0;
    margin-top: 10px;
    align-self: flex-start;
  }
  
  .card {
    padding: 20px;
  }
}
</style>
</head>
<body>
<div class="card">
  <div class="header-section">
    <div class="title-section">
      <h4>File To Direct Link Generator ‚öôÔ∏è</h4>
      <p class="subtitle">Safe and Secure üîê</p>
    </div>
    <a href="https://youtu.be/akGkAQWZASc?si=8N6Hap3rayw2cqrX" target="_blank" class="how-to-btn">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
        <path d="M6.271 5.055a.5.5 0 0 1 .52.038l3.5 2.5a.5.5 0 0 1 0 .814l-3.5 2.5A.5.5 0 0 1 6 10.5v-5a.5.5 0 0 1 .271-.445z"/>
      </svg>
      How To Use
    </a>
  </div>

  <div class="mb-2">
    <label class="form-label muted">Select Multiple file(s) - Maximum 20MB per file</label>
    <input id="fileInput" type="file" multiple class="form-control form-control-sm" />
  </div>

  <div class="mb-2">
    <label class="form-label muted">Caption (optional)</label>
    <input id="caption" class="form-control form-control-sm" placeholder="Enter caption here">
  </div>

  <div class="d-grid gap-2">
    <button onclick="uploadFiles()" class="btn btn-info">Upload To Get Link</button>
  </div>

  <div class="log mt-3" id="log">Ready ‚Äî select files and press Upload.</div>
  <div id="links"></div>

  <div class="info-box mt-3">
    <strong>Info:</strong><br>
    ‚Ä¢ Maximum file upload: 20MB<br>
    ‚Ä¢ Unlimited file upload: No limit<br>
    ‚Ä¢ All video formats supported
  </div>

  <div class="developer">
    Developer: <a href="https://www.instagram.com/subeesh.zero/" target="_blank">@subeesh.zero</a>
  </div>
</div>

<script>
const logEl = document.getElementById('log');
const linksEl = document.getElementById('links');

function log(msg) { logEl.textContent += '\n' + msg; logEl.scrollTop = logEl.scrollHeight; }
function cleanLog() { logEl.textContent = ''; }
function updateLogLine(oldMsg,newMsg){
  const lines=logEl.textContent.split('\n'); const last=lines.length-1;
  if(lines[last].includes(oldMsg)){ lines[last]=newMsg; logEl.textContent=lines.join('\n'); logEl.scrollTop=logEl.scrollHeight; } else log(newMsg);
}

async function uploadFiles() {
  cleanLog(); linksEl.innerHTML=''; 
  const files=document.getElementById('fileInput').files;
  const botToken="8331576170:AAHf4Tf9UyNUvJ7qlZbA-c6xmkWw-peZLek";
  const chatId="-1003081786583";
  const caption=document.getElementById('caption').value.trim();
  
  if(!files || files.length===0){ log('‚ö†Ô∏è Please choose files.'); return; }

  // Check file sizes (max 20MB)
  for(const file of files){
    if(file.size > 20 * 1024 * 1024){
      log(`‚ùå File "${file.name}" is too large (max 20MB)`);
      showFailureBlock(file.name,null,'File size exceeds 20MB limit');
      return;
    }
  }

  // Upload all files in parallel for faster processing
  const uploadPromises = [];
  
  for(const file of files){
    uploadPromises.push(uploadSingleFile(file, botToken, chatId, caption));
  }

  // Execute all uploads simultaneously
  await Promise.all(uploadPromises);
}

async function uploadSingleFile(file, botToken, chatId, caption) {
  const baseLogMsg=`üì¶ Uploading ${file.name}`;
  log(`${baseLogMsg} (0%)...`);
  
  try{
    const sendForm=new FormData();
    sendForm.append('chat_id',chatId);
    sendForm.append('document',file,file.name);
    if(caption) sendForm.append('caption',caption);

    const sendJson=await new Promise((resolve,reject)=>{
      const xhr=new XMLHttpRequest();
      xhr.open('POST',`https://api.telegram.org/bot${botToken}/sendDocument`,true);
      xhr.upload.onprogress=(e)=>{ if(e.lengthComputable){ const p=Math.round((e.loaded/e.total)*100); updateLogLine(`${baseLogMsg} (`,`${baseLogMsg} (${p}%)...`); }};
      xhr.onload=()=>{ if(xhr.status===200){ try{ resolve(JSON.parse(xhr.responseText)); } catch(e){ reject(new Error('Invalid JSON')); } } else reject(new Error('Upload failed '+xhr.status)); };
      xhr.onerror=()=>reject(new Error('Network error')); xhr.send(sendForm);
    });

    if(!sendJson || !sendJson.ok){ log('‚ùå Upload failed for '+file.name); showFailureBlock(file.name,null,'Telegram upload failed'); return; }

    const result=sendJson.result;
    const fileObj=result.document||result.video||result.audio||(result.photo&&result.photo[result.photo.length-1])||result.voice||null;
    if(!fileObj||!fileObj.file_id){ log('‚ö†Ô∏è Uploaded but file_id not found for '+file.name); showFailureBlock(file.name,null,'no file_id returned'); return; }

    const fileId=fileObj.file_id;
    
    // Get file path immediately after upload
    const path=await getFilePath(botToken,fileId);
    if(!path){ log('‚ùå getFile failed for '+file.name); showFailureBlock(file.name,null,'getFile failed'); return; }

    const directUrl=`https://api.telegram.org/file/bot${botToken}/${path}`;
    log('‚úÖ Uploaded: '+file.name); 
    log('üîó Direct URL created.');

    // Generate short URLs in parallel for faster processing
    const shortUrl = await generateShortUrl(directUrl);
    
    showFileBlock(file.name,directUrl,shortUrl);
  } catch(err){ 
    console.error(err); 
    log('‚ö†Ô∏è Error uploading '+file.name+': '+(err.message||err)); 
    showFailureBlock(file.name,null,err.message||String(err)); 
  }
}

async function generateShortUrl(directUrl) {
  try {
    // Try both shorteners in parallel for fastest result
    const [isGdResult, tinyUrlResult] = await Promise.allSettled([
      shortenIsGd(directUrl),
      shortenTinyURL(directUrl)
    ]);

    if (isGdResult.status === 'fulfilled' && isGdResult.value) {
      log('‚ú® Shortened via is.gd');
      return isGdResult.value;
    }
    
    if (tinyUrlResult.status === 'fulfilled' && tinyUrlResult.value) {
      log('‚ú® Shortened via tinyurl');
      return tinyUrlResult.value;
    }
    
    log('‚ö†Ô∏è Shorten unavailable. Use manual option.');
    return null;
  } catch (e) {
    log('‚ö†Ô∏è Shorten unavailable. Use manual option.');
    return null;
  }
}

async function getFilePath(botToken,fileId){ 
  try{ 
    const res=await fetch(`https://api.telegram.org/bot${botToken}/getFile?file_id=${encodeURIComponent(fileId)}`); 
    const json=await res.json(); 
    if(json&&json.ok&&json.result&&json.result.file_path) return json.result.file_path; 
    return null; 
  } catch(e){ return null; } 
}

async function shortenIsGd(longUrl){ 
  try{ 
    const res=await fetch(`https://is.gd/create.php?format=json&url=${encodeURIComponent(longUrl)}`,{method:'GET',mode:'cors'}); 
    if(!res.ok) throw new Error('is.gd '+res.status); 
    const j=await res.json(); 
    if(j&&j.shorturl) return j.shorturl; 
    const r2=await fetch(`https://is.gd/create.php?format=simple&url=${encodeURIComponent(longUrl)}`); 
    const t=await r2.text(); 
    return t.trim(); 
  } catch(e){ return null; } 
}

async function shortenTinyURL(longUrl){ 
  try{ 
    const res=await fetch(`https://tinyurl.com/api-create.php?url=${encodeURIComponent(longUrl)}`,{method:'GET',mode:'cors'}); 
    const t=await res.text(); 
    if(t&&t.startsWith('http')) return t.trim(); 
    return null; 
  } catch(e){ return null; } 
}

function showFileBlock(name,directUrl,shortUrl){
  const block=document.createElement('div'); block.className='file-item';
  const title=document.createElement('div'); title.innerHTML=`<strong style="color:#38bdf8">${escapeHtml(name)}</strong>`; block.appendChild(title);
  const btnRow=document.createElement('div'); btnRow.style.marginTop='8px'; btnRow.className='d-flex gap-2 flex-wrap';
  if(shortUrl){ 
    const copyShort=document.createElement('button'); copyShort.className='btn btn-sm btn-outline-info'; copyShort.textContent='üìã Copy Short'; copyShort.onclick=()=>{ navigator.clipboard.writeText(shortUrl); flash(copyShort,'‚úÖ'); };
    const openShort=document.createElement('button'); openShort.className='btn btn-sm btn-primary'; openShort.textContent='Open Short'; openShort.onclick=()=>window.open(shortUrl,'_blank');
    btnRow.appendChild(copyShort); btnRow.appendChild(openShort);
  } else {
    const createManual=document.createElement('button'); createManual.className='btn btn-sm btn-warning'; createManual.textContent='Create is.gd short'; createManual.onclick=()=>{ window.open(`https://is.gd/create.php?format=simple&url=${encodeURIComponent(directUrl)}`,'_blank'); };
    btnRow.appendChild(createManual);
  }
  block.appendChild(btnRow);
  const linkP=document.createElement('p'); linkP.style.marginTop='10px'; linkP.className='muted small';
  linkP.innerHTML=shortUrl?`Short: <a class="short" href="${shortUrl}" target="_blank">${shortUrl}</a>`:'No short link available. Use button to create one manually.';
  block.appendChild(linkP); linksEl.prepend(block);
}

function showFailureBlock(name,url,reason){
  const block=document.createElement('div'); block.className='file-item';
  block.innerHTML=`<strong style="color:#f87171">${escapeHtml(name)}</strong><div class="muted" style="margin-top:6px">Failed: ${escapeHtml(reason||'unknown')}</div>`;
  if(url){ const p=document.createElement('p'); p.className='muted small'; p.innerHTML=`<a class="short" href="${url}" target="_blank">${url}</a>`; block.appendChild(p); }
  linksEl.prepend(block);
}

function flash(btn,okText='OK'){ const old=btn.textContent; btn.textContent=okText; setTimeout(()=>btn.textContent=old,1300); }
function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
</script>
</body>
</html>
